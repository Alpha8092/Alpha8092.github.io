<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discipline07</title>
    <style>
        :root {
            /* Blue Theme Palette */
            --bg-color: #e3f2fd;        /* Very light blue */
            --card-bg: #ffffff;         /* White */
            --primary-blue: #1565c0;    /* Strong Blue */
            --dark-blue: #0d47a1;       /* Darkest Blue */
            --accent-blue: #42a5f5;     /* Lighter Blue */
            --text-color: #37474f;
            --success-color: #2e7d32;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-top: 70px; /* Space for fixed header */
        }

        /* Header / Upright Corner Stats */
        header {
            background: linear-gradient(90deg, var(--dark-blue), var(--primary-blue));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            box-sizing: border-box;
        }

        .brand {
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }

        .stat-box span {
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            background: white;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text-color);
            border-bottom: 3px solid transparent;
            transition: 0.3s;
        }

        .nav-btn.active {
            color: var(--primary-blue);
            border-bottom: 3px solid var(--primary-blue);
        }

        /* Screens */
        .screen {
            display: none;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
        }

        /* Cards */
        .day-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid var(--primary-blue);
            animation: fadeIn 0.5s ease;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .day-title {
            font-weight: bold;
            color: var(--dark-blue);
        }

        .date-display {
            font-size: 0.85rem;
            color: #777;
        }

        /* Inputs */
        .input-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        label {
            font-weight: 500;
        }

        input[type="number"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 80px;
            font-size: 1rem;
        }

        .locked-msg {
            text-align: center;
            color: #777;
            font-style: italic;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">DISCIPLINE07</div>
        <div class="stats">
            <div class="stat-box">Net Points: <span id="totalPoints">0</span></div>
            <div class="stat-box">Streak: <span id="streakCount">0</span> ðŸ”¥</div>
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="nav-btn active" onclick="switchTab('home')">Today's Action</button>
        <button class="nav-btn" onclick="switchTab('library')">Library (History)</button>
    </nav>

    <div id="home" class="screen active">
        <div id="todayContainer">
            </div>
    </div>

    <div id="library" class="screen">
        <h3>History Log</h3>
        <div id="historyContainer">
            </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // 4 AM IST is UTC+5:30. 
        // We set the target start date: Dec 7th, 2025, 04:00:00 IST
        const START_DATE_STRING = "2025-12-07T04:00:00+05:30";
        
        // --- STATE MANAGEMENT ---
        let appData = JSON.parse(localStorage.getItem('discipline07_data')) || {};

        function saveData() {
            localStorage.setItem('discipline07_data', JSON.stringify(appData));
            updateStats();
        }

        // --- CORE LOGIC ---
        function init() {
            const startDate = new Date(START_DATE_STRING);
            const now = new Date();

            // Calculate days passed since start (floored)
            // 1 Day = 86400000 ms
            const msPerDay = 1000 * 60 * 60 * 24;
            
            // If we are before the start date
            if (now < startDate) {
                document.getElementById('todayContainer').innerHTML = 
                    `<div class="locked-msg">
                        The journey begins on December 7th, 2025 at 4:00 AM IST.<br>
                        <br>Prepare yourself.
                    </div>`;
                return;
            }

            const diffTime = now - startDate;
            const currentDayIndex = Math.floor(diffTime / msPerDay); // 0 = Day 1, 1 = Day 2

            renderApp(startDate, currentDayIndex);
            updateStats(currentDayIndex);
        }

        function renderApp(startDate, currentDayIndex) {
            const todayContainer = document.getElementById('todayContainer');
            const historyContainer = document.getElementById('historyContainer');
            
            todayContainer.innerHTML = '';
            historyContainer.innerHTML = '';

            // We loop from Day Index 0 up to Current Day Index
            // We iterate BACKWARDS for the Library so most recent is top
            for (let i = currentDayIndex; i >= 0; i--) {
                const dayDate = new Date(startDate.getTime() + (i * 24 * 60 * 60 * 1000));
                const dateString = dayDate.toLocaleDateString('en-IN', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
                const dayKey = `day_${i}`; // Unique ID for storage

                // Create Card HTML
                const cardHTML = createCardHTML(i + 1, dateString, dayKey);

                // Add to Library
                historyContainer.innerHTML += cardHTML;

                // Add to Home Screen ONLY if it is the current day (Index matches current)
                if (i === currentDayIndex) {
                    todayContainer.innerHTML = cardHTML;
                }
            }
            
            // Restore values from local storage inputs
            restoreInputValues();
        }

        function createCardHTML(dayNumber, dateString, dayKey) {
            const data = appData[dayKey] || { checked: false, points: 0 };
            
            return `
            <div class="day-card" id="card_${dayKey}">
                <div class="day-header">
                    <span class="day-title">DAY ${String(dayNumber).padStart(2, '0')}</span>
                    <span class="date-display">${dateString}</span>
                </div>
                
                <div class="input-group">
                    <input type="checkbox" id="check_${dayKey}" 
                        onchange="handleCheck('${dayKey}')" ${data.checked ? 'checked' : ''}>
                    <label for="check_${dayKey}">Daily Discipline Complete</label>
                </div>

                <div class="input-group">
                    <label>Points Earned:</label>
                    <input type="number" id="points_${dayKey}" 
                        value="${data.points}" 
                        oninput="handlePoints('${dayKey}')" placeholder="0">
                </div>
            </div>
            `;
        }

        // --- EVENT HANDLERS ---
        window.handleCheck = function(dayKey) {
            if (!appData[dayKey]) appData[dayKey] = { checked: false, points: 0 };
            const checkbox = document.getElementById(`check_${dayKey}`);
            
            // Sync checkbox in both screens if visible (simplification: just saving state)
            appData[dayKey].checked = checkbox.checked;
            saveData();
            
            // Re-render isn't strictly necessary for logic, but ensures UI consistency if we switch tabs
            // For performance in a simple app, we just let the DOM stay as is until reload/tab switch
        };

        window.handlePoints = function(dayKey) {
            if (!appData[dayKey]) appData[dayKey] = { checked: false, points: 0 };
            const input = document.getElementById(`points_${dayKey}`);
            
            appData[dayKey].points = parseInt(input.value) || 0;
            saveData();
        };

        // --- STATS CALCULATION ---
        function updateStats(currentDayIndex) {
            let totalPoints = 0;
            let currentStreak = 0;
            let streakBroken = false;

            // Calculate Total Points
            Object.values(appData).forEach(day => {
                totalPoints += (day.points || 0);
            });

            // Calculate Streak (Count backwards from today)
            // If today is checked, streak starts at 1. If not, streak is 0 (or pending)
            // But usually streak implies consecutive days ending yesterday or today.
            
            // We need to loop from currentDayIndex downwards
            if (typeof currentDayIndex !== 'undefined') {
                for (let i = currentDayIndex; i >= 0; i--) {
                    const key = `day_${i}`;
                    const entry = appData[key];

                    if (entry && entry.checked) {
                        currentStreak++;
                    } else {
                        // If it's TODAY and unchecked, we don't break streak yet (user has time left)
                        // If it's a past day and unchecked, streak is over.
                        if (i !== currentDayIndex) {
                            break;
                        }
                    }
                }
            }

            // Update UI
            document.getElementById('totalPoints').innerText = totalPoints;
            document.getElementById('streakCount').innerText = currentStreak;
        }

        // Restore visual state for inputs (needed because we render HTML strings)
        function restoreInputValues() {
            // The HTML rendering sets the 'value' and 'checked' attributes, 
            // but this function ensures DOM properties are synced if needed.
            // (Handled mostly in createCardHTML via template literals)
        }

        // --- UI UTILS ---
        window.switchTab = function(tabName) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            
            // Highlight button
            const btnIndex = tabName === 'home' ? 0 : 1;
            document.querySelectorAll('.nav-btn')[btnIndex].classList.add('active');
            
            // Refresh logic to ensure data is synced between views
            init(); 
        }

        // Run on load
        init();
        
        // Refresh every minute to check if 4 AM passed
        setInterval(init, 60000); 

    </script>
</body>
  </html>
  
